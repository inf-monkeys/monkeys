# Agent èŠå¤©é¡µé¢ - ThreadListRuntime é›†æˆå®Œæˆ

## âœ… å·²å®Œæˆçš„æ”¹è¿›

### 1. é¡µé¢é‡å†™ ([index.lazy.tsx](./index.lazy.tsx))

**ä¹‹å‰çš„é—®é¢˜:**
- âŒ æ‰‹åŠ¨ç®¡ç† threadId çŠ¶æ€
- âŒ æ‰‹åŠ¨åˆ›å»ºå’Œåˆ‡æ¢ thread
- âŒ ä½¿ç”¨æ—§çš„ `useAgentChat` hook (å•çº¿ç¨‹)
- âŒ ThreadList ç»„ä»¶æ²¡æœ‰æ•°æ®æ”¯æŒ
- âŒ å¤æ‚çš„çŠ¶æ€ç®¡ç†ä»£ç  (~160 è¡Œ)

**ç°åœ¨çš„å®ç°:**
- âœ… ä½¿ç”¨ `AgentRuntimeProvider` è‡ªåŠ¨ç®¡ç†æ‰€æœ‰çŠ¶æ€
- âœ… å®Œæ•´çš„ ThreadListRuntime æ”¯æŒ
- âœ… assistant-ui åŸç”Ÿ Thread å’Œ ThreadList ç»„ä»¶
- âœ… è‡ªåŠ¨åŠ è½½å’ŒåŒæ­¥æ¶ˆæ¯
- âœ… ç®€æ´çš„ä»£ç  (~90 è¡Œ)

**ä»£ç å¯¹æ¯”:**

```tsx
// æ—§å®ç° âŒ
const [threadId, setThreadId] = useState<string>();
const { runAsync: createThread } = useCreateThread(teamId);

useEffect(() => {
  // å¤æ‚çš„æ‰‹åŠ¨åˆ›å»ºé€»è¾‘...
}, [agent, userId, threadId]);

const { runtime } = useAgentChat({ threadId, teamId, userId });

// æ–°å®ç° âœ…
<AgentRuntimeProvider teamId={teamId} userId={userId} agentId={agentId}>
  <ThreadList />
  <Thread />
</AgentRuntimeProvider>
```

### 2. ThreadList ç»„ä»¶å¢å¼º ([thread-list.tsx](../../../components/assistant-ui/thread-list.tsx))

**æ–°å¢åŠŸèƒ½:**
- âœ… "New Conversation" æŒ‰é’® (ä½¿ç”¨ `ThreadListPrimitive.New`)
- âœ… ç©ºçŠ¶æ€æ˜¾ç¤º (ä½¿ç”¨ `ThreadListPrimitive.Empty`)
- âœ… æ”¹è¿›çš„è§†è§‰æ ·å¼å’Œå¸ƒå±€
- âœ… æ›´å¥½çš„äº¤äº’åé¦ˆ (hover, active çŠ¶æ€)
- âœ… åˆ é™¤æŒ‰é’®çš„å¯è®¿é—®æ€§æ ‡ç­¾

**UI æ”¹è¿›:**
```tsx
âœ… æ–°å»ºå¯¹è¯æŒ‰é’®
âœ… å¯¹è¯åˆ—è¡¨ (è‡ªåŠ¨æ»šåŠ¨)
âœ… ç©ºçŠ¶æ€æç¤º
âœ… æ´»åŠ¨çŠ¶æ€é«˜äº®
âœ… Hover æ•ˆæœ
âœ… åˆ é™¤ç¡®è®¤ (å†…ç½®)
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### è‡ªåŠ¨å¤„ç†çš„åŠŸèƒ½

1. **Thread ç®¡ç†**
   - âœ… è‡ªåŠ¨åŠ è½½ thread åˆ—è¡¨
   - âœ… åˆ›å»ºæ–°å¯¹è¯
   - âœ… åˆ‡æ¢å¯¹è¯
   - âœ… åˆ é™¤å¯¹è¯
   - âœ… é‡å‘½åå¯¹è¯ (UI æ”¯æŒ,éœ€å¯ç”¨)

2. **æ¶ˆæ¯å¤„ç†**
   - âœ… è‡ªåŠ¨åŠ è½½å†å²æ¶ˆæ¯
   - âœ… æµå¼å“åº”æ˜¾ç¤º
   - âœ… å·¥å…·è°ƒç”¨æ”¯æŒ
   - âœ… é”™è¯¯å¤„ç†

3. **çŠ¶æ€åŒæ­¥**
   - âœ… Thread åˆ—è¡¨å®æ—¶æ›´æ–°
   - âœ… æ¶ˆæ¯è‡ªåŠ¨åŒæ­¥åˆ°åç«¯
   - âœ… å½“å‰ thread é«˜äº®æ˜¾ç¤º
   - âœ… è¿è¡ŒçŠ¶æ€ç®¡ç†

## ğŸ“ é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent Chat Page                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ThreadList   â”‚  Thread                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Agent    â”‚â”‚  â”‚                         â”‚â”‚
â”‚  â”‚ Name     â”‚â”‚  â”‚  Welcome Message        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚  or                     â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚  Message List           â”‚â”‚
â”‚  â”‚[+ New]   â”‚â”‚  â”‚                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚                         â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚                         â”‚â”‚
â”‚  â”‚Thread 1  â”‚â”‚  â”‚                         â”‚â”‚
â”‚  â”‚Thread 2  â”‚â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚...       â”‚â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚  Composer               â”‚â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ
   â†“
ThreadListRuntime (useThreadListRuntime)
   â†“
ExternalStoreRuntime + ThreadListAdapter
   â†“
åç«¯ API (threadApi, chatApi)
   â†“
æ•°æ®åº“
   â†“
å®æ—¶æ›´æ–° UI
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

è®¿é—®é¡µé¢:
```
http://localhost:3000/{teamId}/agents/{agentId}
```

åŠŸèƒ½:
1. âœ… é¡µé¢åŠ è½½ â†’ è‡ªåŠ¨åˆ›å»ºé¦–ä¸ªå¯¹è¯
2. âœ… ç‚¹å‡» "New Conversation" â†’ åˆ›å»ºæ–°å¯¹è¯
3. âœ… ç‚¹å‡»åˆ—è¡¨ä¸­çš„å¯¹è¯ â†’ åˆ‡æ¢å¯¹è¯
4. âœ… å‘é€æ¶ˆæ¯ â†’ æµå¼å“åº”
5. âœ… Hover å¯¹è¯ â†’ æ˜¾ç¤ºåˆ é™¤æŒ‰é’®
6. âœ… ç‚¹å‡»åˆ é™¤ â†’ ç¡®è®¤ååˆ é™¤

### æ‰©å±•åŠŸèƒ½ (å¾…å®ç°)

å¯é€‰å¢å¼º:
- [ ] å¯¹è¯é‡å‘½å (UI å·²æ”¯æŒ,éœ€å¯ç”¨ç¼–è¾‘æ¨¡å¼)
- [ ] å¯¹è¯å½’æ¡£
- [ ] å¯¹è¯æœç´¢
- [ ] å¯¹è¯æ ‡ç­¾
- [ ] å¯¼å‡ºå¯¹è¯

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ThreadList ä¸ºç©º

**å¯èƒ½åŸå› :**
- Runtime æœªæ­£ç¡®åˆå§‹åŒ–
- API è°ƒç”¨å¤±è´¥
- teamId/userId ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. éªŒè¯ API ç«¯ç‚¹
3. ç¡®è®¤è®¤è¯ token

### é—®é¢˜ 2: æ— æ³•åˆ›å»ºæ–°å¯¹è¯

**å¯èƒ½åŸå› :**
- `onSwitchToNewThread` æœªæ­£ç¡®å®ç°
- API åˆ›å»ºå¤±è´¥
- æƒé™ä¸è¶³

**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥ç½‘ç»œè¯·æ±‚
2. éªŒè¯ teamId å’Œ userId
3. æŸ¥çœ‹åç«¯æ—¥å¿—

### é—®é¢˜ 3: æ¶ˆæ¯ä¸æ˜¾ç¤º

**å¯èƒ½åŸå› :**
- Thread æœªåŠ è½½æ¶ˆæ¯
- æ¶ˆæ¯æ ¼å¼è½¬æ¢é”™è¯¯
- API è¿”å›æ ¼å¼ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥ `loadThreadMessages` è°ƒç”¨
2. éªŒè¯æ¶ˆæ¯è½¬æ¢é€»è¾‘
3. æŸ¥çœ‹ API å“åº”æ ¼å¼

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ä»£ç ç®€åŒ–

| æŒ‡æ ‡ | æ—§å®ç° | æ–°å®ç° | æ”¹è¿› |
|------|--------|--------|------|
| ä»£ç è¡Œæ•° | ~160 | ~90 | -44% |
| çŠ¶æ€å˜é‡ | 3+ | 0 | -100% |
| useEffect | 1 | 0 | -100% |
| æ‰‹åŠ¨ API è°ƒç”¨ | 2+ | 0 | -100% |

### åŠŸèƒ½å®Œæ•´æ€§

| åŠŸèƒ½ | æ—§å®ç° | æ–°å®ç° |
|------|--------|--------|
| å¤šçº¿ç¨‹æ”¯æŒ | âŒ | âœ… |
| è‡ªåŠ¨åŠ è½½æ¶ˆæ¯ | âŒ | âœ… |
| Thread åˆ‡æ¢ | âš ï¸ éƒ¨åˆ† | âœ… |
| æµå¼å“åº” | âœ… | âœ… |
| å·¥å…·è°ƒç”¨ | âš ï¸ éœ€æ‰‹åŠ¨ | âœ… |
| çŠ¶æ€åŒæ­¥ | âŒ | âœ… |

## ğŸš€ ä¸‹ä¸€æ­¥

### å»ºè®®çš„å¢å¼º

1. **UI ä¼˜åŒ–**
   - [ ] æ·»åŠ å¯¹è¯é¢„è§ˆ (æœ€åä¸€æ¡æ¶ˆæ¯)
   - [ ] æ˜¾ç¤ºå¯¹è¯æ—¶é—´
   - [ ] å¯¹è¯æ•°é‡ç»Ÿè®¡
   - [ ] åŠ è½½éª¨æ¶å±

2. **åŠŸèƒ½æ‰©å±•**
   - [ ] å¯¹è¯æœç´¢
   - [ ] æ‰¹é‡æ“ä½œ
   - [ ] å¯¼å‡ºå¯¹è¯
   - [ ] åˆ†äº«å¯¹è¯

3. **æ€§èƒ½ä¼˜åŒ–**
   - [ ] è™šæ‹Ÿæ»šåŠ¨ (å¤§é‡å¯¹è¯)
   - [ ] æ¶ˆæ¯åˆ†é¡µåŠ è½½
   - [ ] å›¾ç‰‡æ‡’åŠ è½½

## ğŸ“ ç›¸å…³æ–‡ä»¶

- [AgentRuntimeProvider.tsx](../features/agent/components/AgentRuntimeProvider.tsx) - Runtime Provider
- [useThreadListRuntime.ts](../features/agent/hooks/useThreadListRuntime.ts) - Core Runtime
- [thread-list.tsx](../../../components/assistant-ui/thread-list.tsx) - ThreadList UI
- [thread.tsx](../../../components/assistant-ui/thread.tsx) - Thread UI

## ğŸ“ å­¦ä¹ èµ„æº

- [ThreadListRuntime æ–‡æ¡£](../features/agent/docs/ThreadListRuntime.md)
- [å¿«é€Ÿå¼€å§‹æŒ‡å—](../features/agent/QUICKSTART.md)
- [Assistant-UI å®˜æ–¹æ–‡æ¡£](https://docs.assistant-ui.com)

---

**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
**æœ€åæ›´æ–°**: 2025-01-XX
**ç‰ˆæœ¬**: 1.0.0
